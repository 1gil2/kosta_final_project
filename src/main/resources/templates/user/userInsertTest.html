<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{/layout/layoutUser}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<<th:block layout:fragment="script1">
  <script>
  $(function(){
	    //값 초기화. 회원가입 버튼 비활성화
	    $("#btnConfirm").prop("disabled",true);
	    var idOk = false;
	    var pw1Ok = false;
	    var pw2Ok = false;
	    var nameOk = false;
	    var emailOk = false;
	    var isOk = false;    
	    
	    //정규식 활용 id 체크(영소문자+숫자 5자 이상)
	    $("#inputUserId").keyup(function(){    
	        
	        //배열 초기화
	        var viewData = {};        
	        var inputTxt = $("#inputUserId").val();
	        //data[키] = 밸류
	        viewData["inputUserId"] = inputTxt;
	        
	        var chkOnlyEngNum = /^[a-zA-Z0-9_-]{4,20}$/;
	 
	        if( chkOnlyEngNum.test(inputTxt) || inputTxt.length > 3){
	            //정규식 조건을 통과한 경우
	            $("#signupWarn").text( '　' );    
	            //Ajax 활용 ID 중복체크, 중복이 아니면? true = 사용가능 ID            
	            var varIsNotDupId = false;
	            //초기값 valid 적용
	            $("#inputUserId").removeClass("is-invalid");
	            $("#inputUserId").addClass("is-valid");
	            $.ajax({
	                type: "POST"
	                //동기식으로 변경 >> ajax에서 리턴값을 이용하기 위해
	                , async: false
	                , contentType:'application/json'
	                , url: '/user/userIdChk'
	                , datatype: "json"
	                , data: JSON.stringify(viewData)
	                , success: function( data ){
	 
	                    if( data === '0' ){
	                        //컨트롤러에서 넘어온 결과가 0인 경우 사용 가능한 아이디로 판단
	                        //alert('ok data 트루라고 했다');
	                        $("#inputIdInSignup").removeClass("is-invalid");
	                        $("#inputIdInSignup").addClass("is-valid");
	                        varIsNotDupId = true;
	                        idOk = true;
	                        $("#signupWarn").text( '　' );            
	                        isOk = allOk( idOk, pw1Ok, pw2Ok, nameOk, emailOk );
	                        if( isOk == true ){
	                            $("#btnConfirm").prop("disabled",false);
	                        }
	                        $("#chkAllOk").text(idOk + ', ' + pw1Ok + ', ' + pw2Ok + ', ' + nameOk + ', ' + emailOk + '마지막 idOk:' + isOk );
	                    }else{
	                        //중복된 ID인 경우
	                        $("#inputIdInSignup").removeClass("is-valid");
	                        $("#inputIdInSignup").addClass("is-invalid");
	                        idOk = false;
	                        $("#chkAllOk").text(idOk + ', ' + pw1Ok + ', ' + pw2Ok + ', ' + nameOk + ', ' + emailOk + '마지막 idOk:' + isOk );
	                        $("#signupWarn").text( '중복된 ID입니다. 다른 ID를 입력해 주세요.' );
	                        $("#btnConfirm").prop("disabled",true);
	                    }
	                    
	                }, error: function( error ){
	                    alert('error : ' + error);
	                }
	            });                    
	        }else{
	            //조건에 맞지 않는 경우
	            idOk = false;
	            $("#btnConfirm").prop("disabled",true);
	            $("#inputIdInSignup").removeClass("is-valid");
	            $("#inputIdInSignup").addClass("is-invalid");
	        }
	    });
	    
	    //이름 길이 체크. 2자~20자까지
	    $("#inputName").keyup(function(){
	        var inputLen = $("#inputName").val().length;
	        var chkBlank = /\s/g;
	        var chkResult = chkBlank.test( $("#inputName").val() );
	        
	        //길이에 맞지 않거나 공백이 포함되어 있는 경우
	        if((inputLen < 2 || inputLen > 20) || chkResult ){            
	            nameOk = false;            
	            $("#btnSignupInSignupModal").prop("disabled",true);
	            
	            $("#inputName").removeClass("is-valid");
	            $("#inputName").addClass("is-invalid");
	        }else{            
	            nameOk = true;
	            $("#signupWarn").text( '　' );
	            isOk = allOk( idOk, pw1Ok, pw2Ok, nameOk, emailOk );
	            if( isOk == true ){
	                $("#btnConfirm").prop("disabled",false);
	            }            
	            $("#inputName").removeClass("is-invalid");
	            $("#inputName").addClass("is-valid");
	        }
	    });
	    
	    //PW 길이 체크
	    $("#inputPw1InSignup").keyup(function(){
	        if( $("#inputPw1InSignup").val().length < 5 ){
	            pw1Ok = false;
	            $("#btnSignupInSignupModal").prop("disabled",true);
	            $("#inputPw1InSignup").removeClass("is-valid");
	            $("#inputPw1InSignup").addClass("is-invalid");
	        }else{
	            pw1Ok = true;
	            $("#signupWarn").text( '　' );            
	            isOk = allOk( idOk, pw1Ok, pw2Ok, nameOk, emailOk );
	            if( isOk == true ){
	                $("#btnConfirm").prop("disabled",false);
	            }
	            $("#chkAllOk").text(idOk + ', ' + pw1Ok + ', ' + pw2Ok + ', ' + nameOk + ', ' + emailOk + '마지막 idOk:' + isOk );
	            $("#inputPw1InSignup").removeClass("is-invalid");
	            $("#inputPw1InSignup").addClass("is-valid");
	        }
	    });
	    
	    //PW 확인 체크
	    $("#inputPw2InSignup").keyup(function(){
	        var pw1 = $("#inputPw1InSignup").val();
	        var pw2 = $("#inputPw2InSignup").val();
	        if( pw1 == pw2 ){
	            pw2Ok = true;            
	            $("#signupWarn").text( '　' );            
	            isOk = allOk( idOk, pw1Ok, pw2Ok, nameOk, emailOk );
	            if( isOk == true ){
	                $("#btnConfirm").prop("disabled",false);
	            }
	            $("#chkAllOk").text(idOk + ', ' + pw1Ok + ', ' + pw2Ok + ', ' + nameOk + ', ' + emailOk + '마지막 idOk:' + isOk );
	            $("#inputPw2InSignup").removeClass("is-invalid");
	            $("#inputPw2InSignup").addClass("is-valid");
	        }else{
	            pw2Ok = false;
	            $("#btnSignupInSignupModal").prop("disabled",true);
	            $("#inputPw2InSignup").removeClass("is-valid");
	            $("#inputPw2InSignup").addClass("is-invalid");
	        }
	    });
	    
	    //E-mail 체크
	    $("#inputEmailInSignup").keyup(function(){
	        var inputTxt = $("#inputEmailInSignup").val();
	        var chkEmail = /^[a-zA-Z0-9]+@([a-zA-Z0-9]{1,10})\.([a-zA-Z]{1,10})+$/;
	        if( chkEmail.test(inputTxt) ){
	            emailOk = true;
	            $("#signupWarn").text( '　' );
	            isOk = allOk( idOk, pw1Ok, pw2Ok, nameOk, emailOk );
	            if( isOk == true ){
	                $("#btnConfirm").prop("disabled",false);
	            }
	            //$("#chkAllOk").text(idOk + ', ' + pw1Ok + ', ' + pw2Ok + ', ' + nameOk + ', ' + emailOk);
	            $("#inputEmailInSignup").removeClass("is-invalid");
	            $("#inputEmailInSignup").addClass("is-valid");
	        }else{
	            emailOk = false;
	            $("#btnSignupInSignupModal").prop("disabled",true);
	            $("#inputEmailInSignup").removeClass("is-valid");
	            $("#inputEmailInSignup").addClass("is-invalid");
	        }
	    });
	    
	    //회원가입 버튼 클릭 이벤트
	    $("#btnConfirm").click(function(){
	        $("#frmRegistration").attr("action", ctx + "/regi/insert")
	        $("#frmRegistration").submit();
	    });
	});
	 
	function allOk( ok1, ok2, ok3, ok4, ok5 ){
	    if( ok1 && ok2 && ok3 && ok4 && ok5 ){
	        return true;
	    }else{
	        return false;
	    }
	}

  </script>
</th:block>

<th:block layout:fragment="style1">
  <style>
    .register-container {
    	width: 700px;
    	margin: auto;
    }
    
    .row {
    	margin-right: -15px;
    	margin-left: -15px;
    }
    
    .col-md-12 {
    	width: 100%;
    }
  </style>
</th:block>
</head>
<body>
  <div class="panel panel-default" layout:fragment="content1">
  <div id="signupWarn"></div>
  <div id="chkAllOk"></div>
    <div class="register-container">
      <div class="row">
        <div class="col-md-12">
          <div class="text-center m-b-md">
            <h3>회원가입</h3>
          </div>
          <!-- 유저정보 입력 부분 -->
          <form action="/signup" method="POST" id="signupForm" novalidate="novalidate">
            <div class="hpanel">
              <div class="panel-body">
                <div class="row">
                
                  <div class="col-lg-6">
                      <div id="userId" class="userId-group">
                        <div class="form-group cust-form has-feedback ">
                          <label for="inputUserId" class="control-label">
                            아이디 
                            <span class="help-inline">*</span>
                          </label >
                          <input type="text" id="inputUserId" name="userId" placeholder="4~20자 소문자 또는 숫자" class="form-control" required="required" autofocus="autofocus">
                          <div id="idEnable" class="is-invalid" style="font-size:5px;">
                            사용 가능한 아이디입니다.
                          </div>
                          <div id="idDisable" class="is-invalid">
                            사용할 수 없는 아이디입니다.
                         </div>
                          <span class="help-block"></span>
                        </div>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group cust-form has-feedback">
                      <label for="userName" class="control-label">
                        이름 
                        <span class="help-inline">*</span>
                      </label> 
                      <input type="text" id="name" name="userName" value="" class="form-control" placeholder="ex) 홍길동">
                      <span class="help-block"></span>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group cust-form has-feedback">
                      <label for="newPassword" class="control-label">
                        비밀번호 
                        <span class="help-inline">*</span>
                      </label>
                      <!-- 대소문자 구분 안할때는 placeholder  삭제 --> 
                      <input type="password" id="newPassword" name="userPw" class="form-control" placeholder="8~16자 숫자,소문자,대문자를 포함"> 
                      <span class="help-block"></span>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group cust-form has-feedback">
                      <label for="confirmPassword" class="control-label">
                        비밀번호 확인
                        <span class="help-inline">*</span>
                      </label>
                      <input type="password" id="confirmPassword" name="confirmPassword" class="form-control" placeholder="8~16자 숫자,소문자,대문자를 포함">
                      <div id="pwEnable" class="is-invalid">
                        사용 가능한 비밀번호입니다.
                      </div>
                      <div id="pwDisable" class="is-invalid">
                        비밀번호가 일치하지 않습니다.
                     </div>
                     <span class="help-block"></span>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group cust-form has-feedback">
                      <label for="cellPhone" class="control-label">
                        휴대전화 번호
                        <span class="help-inline">*</span>
                      </label>
                      <input type="text" id="cellPhone" name="userPhone" value="" class="form-control" placeholder="ex) 01012341234 숫자만 가능">
                      <span class="help-block"></span>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group cust-form has-feedback">
                      <label for="sex" class="control-label">
                        성별
                        <span class="help-inline">*</span>
                      </label>
                      <span class="buttonset" id="sex">
                        <input type="radio" id="sex_true" name="sex" value="M" class="radio-inline">
                        <label for="sex_true">남</label>
                        <input type="radio" id="sex_false" name="sex" value="F" checked="checked" class="radio-inline">
                        <label for="sex_false">여</label>
                      </span>
                      <span class="help-block"></span>
                    </div>
                  </div>
                  <div class="col-lg-12">
                    <div class="row">
                      <div class="col-md-2">
                        <div class="form-group has-feedback ">
                          <label for="zipCode" class="control-label">
                            우편번호 
                            <span class="help-inline">*</span>
                          </label>
                          <input type="text" id="zipCode" name="zipCode" value="" class="form-control " readonly="readonly">
                          <span class="help-block"></span>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="form-group has-feedback ">
                          <label for="address" class="control-label">
                            주소 
                            <span class="help-inline">*</span>
                          </label>
                          <input type="text" id="address" name="address" value="" class="form-control " readonly="readonly">
                          <span class="help-block"></span>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="form-group has-feedback ">
                          <label for="detailAddress" class="control-label"> 
                            상세주소
                            <span class="help-inline">*</span>
                          </label> 
                          <input type="text" id="detailAddress" name="detailAddress" value="" class="form-control ">
                          <span class="help-block"></span>
                        </div>
                      </div>
                      <div class="form-group has-feedback col-md-1">
                        <button type="button" id="searchAddress" class="btn btn-default" style="margin-top: 24px;">주소찾기</button>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group cust-form has-feedback ">
                      <label for="birthDate" class="control-label">
                        생년월일 
                        <span class="help-inline">*</span>
                      </label>
                      <input type="date" id="birthDate" name="userBirth" value="" class="form-control">
                      <span class="help-block"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="hpanel">
              <div class="panel-body">
                <div class="row">
                  <div class="form-group ng-scope">
                    <div class="col-lg-6">
                      <div id="emailauth" class=" input-group">
                        <div class="form-group cust-form has-feedback ">
                          <label for="email" class="control-label">
                            이메일 
                            <span class="help-inline">*</span>
                          </label>
                          <input type="text" id="email" name="userEmail" placeholder="ex) user@kosta.or.kr" class="form-control">
                          <span class="help-block"></span>
                        </div>
                        <span class="kt-pl-30 input-group-btn">
                          <button type="button" id="emailSendBtn" class="ladda-button btn btn-default" style="margin-top: 24px;">인증번호발송</button>
                        </span>
                      </div>
                    </div>
                    <div class="col-lg-6">
                      <div id="emailauth" class="input-group">
                        <div class="form-group cust-form">
                          <label for="authNum" class="control-label">
                            인증번호
                            <code class="help-inline ng-binding">(03:00)</code>
                          </label>
                          <input type="text" id="authNum" name="authNum" class="form-control" placeholder="인증번호를 입력해 주세요.">
                        </div>
                        <span class="kt-pl-30 input-group-btn">
                          <button type="button" id="btnConfirm" class="ladda-button btn btn-default" style="margin-top: 24px;">
                            인증
                          </button>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>  
              </div>
            </div>
            <div class="text-center kt-mb-50">
              <button class="btn btn-success">회원가입</button>
              <a href="/login" class="btn btn-default">취소</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</body>
</html>