<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layout/layoutadmin}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<div class="panel panel-default" layout:fragment="content1">
	<table border="1">
	<tr>
	 <th>상태</th>
	 <th>아이디</th>
	 <th>이름</th>
	 <th>직무</th>
	 <th>직함</th>
	 <th>전화번호</th>
	 <th>이메일</th>
	 <th>주민번호</th>
	 <th>협약사</th>
	 <th>소속회사</th>
	 <th>수강신청일</th>
	 <th>상태변경</th>
	</tr>
	<tr th:each="classHistory:${classHistoryList}" >
		<td th:if="${#strings.toString(classHistory.classHistoryState)}=='WAIT'" th:text="대기">상태</td>
		<td th:if="${#strings.toString(classHistory.classHistoryState)}=='CANCEL'" th:text="취소">상태</td>
		<td th:if="${#strings.toString(classHistory.classHistoryState)}=='COMMIT'" th:text="확정">상태</td>
		<td th:if="${#strings.toString(classHistory.classHistoryState)}=='COMPLETE'" th:text="수강완료">상태</td>
		<td th:text="${classHistory.user.userId}">아이디</td>
		<td th:text="${classHistory.user.userName}">이름</td>
		<td th:text="${classHistory.user.userJob}">직무</td>
		<td th:text="${classHistory.user.userPosition}">직함</td>
		<td th:text="${classHistory.user.userPhone}">전화번호</td>
		<td th:text="${classHistory.user.userEmail}">이메일</td>
		<td th:text="${classHistory.user.userIdentity}">주민번호</td>
		<td th:if="${#strings.toString(classHistory.user.company.companyConvention)}=='Convention'" th:text="협약사">협약사</td>
		<td th:if="${#strings.toString(classHistory.user.company.companyConvention)}=='NoConvention'" th:text="비협약사">협약사</td>
		<td th:text="${classHistory.user.company.companyName}">소속회사</td>
		<td th:text="${#temporals.format(classHistory.classHistoryDate,'yyyy-MM-dd hh:mm:ss')}">수강신청일</td>
		<td>
		<th:block th:if="${#strings.toString(classHistory.classHistoryState)}=='WAIT'">
			<td><button onclick='commit(this,"${classHistory.classHistoryNo}");'>확정</button></td>
			<td><button onclick='cancel(this,"${classHistory.classHistoryNo}");'>취소</button></td>
		</th:block>
		<th:block th:if="${#strings.toString(classHistory.classHistoryState)}=='CANCEL'">
			<td><button onclick='commit(this,"${classHistory.classHistoryNo}");'>확정</button></td>
			<td><button onclick='wait(this,"${classHistory.classHistoryNo}");'>대기</button></td>
		</th:block>
		<th:block th:if="${#strings.toString(classHistory.classHistoryState)}=='COMMIT'">
			<td><button onclick='wait(this,"${classHistory.classHistoryNo}");'>대기</button></td>
			<td><button onclick='cancel(this,"${classHistory.classHistoryNo}");'>취소</button></td>
		</th:block>
		<th:block th:if="${#strings.toString(classHistory.classHistoryState)}=='COMPLETE'">
			<div>완료</div>
		</th:block>
		</td>
	</tr>
	</table>
</div>
<th:block layout:fragment="script1">
	<script>
	$(function(){
		 function commit(obj,classHistoryNo){
			  $.ajax({
				  url:"adminStudioApprove",
				  data:{"studio_no":studio_no},
				  success:function(responsedata){
					  $(obj).parent().prev().html("승인완료");
				  }
			  });
		  }
		  function wait(obj,studio_no){
			  $.ajax({
				  url:"adminStudioDisapprove",
				  data:{"studio_no":studio_no},
				  success:function(){
					  location.reload();
					  //$("#studioAll").trigger("click");
					  //$("#content").load("adminSearchStudioAll");
				  }
			  });
		 }
		  function cancel(obj,studio_no){
			  $.ajax({
				  url:"adminStudioDisapprove",
				  data:{"studio_no":studio_no},
				  success:function(){
					  location.reload();
					  //$("#studioAll").trigger("click");
					  //$("#content").load("adminSearchStudioAll");
				  }
			  });
		 }
	});
	</script>
</th:block>
</body>
</html>